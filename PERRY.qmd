---
title: "PERRY"
author: "Daphné Perry"
format: 
  html: default
  pdf: default
---

```{r}
#| message: false
#| warning: false
library(vroom)
library(ggplot2)
library(knitr)
library(dplyr)
library(here)
library(tidyr)
library(lubridate)
library(readr)
library(tidyverse)
here::i_am("grades.Rproj")
```

Link to my GitHub repository: https://github.com/Byxac/grades.git

# Introduction

## Q1:

```{r}
#| message: false
#| warning: false
courses <- vroom(here("data", "courses.csv"))
```

## Q2

```{r}
#| message: false
#| warning: false
courses |>
  arrange(course) |>
  rename(
    "course name" = course,
    "identifier" = course_id,
    "trimester" = trimester,
    "number of exams" = nb_grades 
  ) |>
  kable()
```

## Q3

```{r}
#| message: false
#| warning: false
students <- vroom(here("data", "students.csv"))|>
   mutate(
    birth_date = ymd(birth_date),
    sex = factor(sex),
    group = factor(group)
  )
```

In the `students` dataset, the `birth_date` variable is correctly stored as a `Date` object.

## Q4

```{r}
#| message: false
#| warning: false
grades <- read_delim(
  "data/grades.csv",
  delim = ";",
  na = "_"
)
```

## Q5

```{r}
#| message: false
#| warning: false
students |>
  count(group) |>
  ggplot(aes(x = group, y = n)) +
  geom_col()
```

## Q6

```{r}
#| message: false
#| warning: false
students |>
  count(group, sex) |>
  ggplot(aes(x = group, y = n, fill = sex)) +
  geom_col(position = "dodge")
```

## Q7

```{r}
#| message: false
#| warning: false
students <- students |>
  mutate(
    age = time_length(today() - birth_date, "year") |> round()
  )

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1)
```

## Q8

```{r}
#| message: false
#| warning: false
median_age <- students |> 
  group_by(group) |> 
  summarise(median_age = as.integer(median(age)))

median_age |> 
  kable(col.names = c("Group", "Median age"))
```

## Q9

```{r}
#| message: false
#| warning: false
students |>
  arrange(desc(age)) |>
  group_by(group) |>
  slice_max(age, n = 1) |>
  ungroup() |>
  arrange(desc(age)) |>
  select(id, sex, age, group) |>
  kable()
```

## Q10

The data set contains `r grades |> drop_na(grade) |> nrow()` grades.

## Q11

```{r}
#| message: false
#| warning: false
combat_id <- courses |> 
  filter(course == "Combat and Martial Arts of the Gods") |> 
  pull(course_id)

grades |>
  filter(course_id == combat_id) |>
  left_join(students, by = "id") |>
  group_by(group) |>
  summarise(avg_combat = mean(grade, na.rm = TRUE)) |>
  ggplot(aes(x = group, y = avg_combat)) +
  geom_col()
```

Even though the average grade in the **Combat and Martial Arts of the Gods** class is around 8 for every group, the grades can go from 0 up to 20 (so this graphic is not that representative, but if we scale the average grade from 0 to 20, the differences between the groups are harder to observe).

## Q12

```{r}
#| message: false
#| warning: false
grades |>
  left_join(courses, by = "course_id") |>
  ggplot(aes(x = grade, fill = factor(trimester))) +
  geom_density(alpha = 0.5)
```

The graph shows the density distributions of grades for the three trimesters. From the plot, we can observe the following patterns:

**Trimester 1**: The grades are almost following a distribution, centered around higher grades (roughly between 8 and 12). It has the highest peak, meaning grades are more concentrated around that central value. Overall, trimester 1 appears to have the best performance.

**Trimester 2**: The distribution is more spread out and slightly shifted to the right compared to trimester 1. The peak is lower, meaning grades are more variable. Grades range roughly from 7 to 15, with many around 8–10. Performance is solid but less consistent than in trimester 1.

**Trimester 3**: The distribution is clearly shifted toward lower grades. Many grades fall between 5 and 10, with a peak around 7 (almost 25% of the students have this grade). There is also a long right tail: this is the semester with the largest proportion of students having 20/20 (about 2,5%, compared to almost 0 during the other trimesters). Trimester 3 shows the lowest performance overall.

## Q13

```{r}
#| message: false
#| warning: false
grades_count <- grades |>
  drop_na(grade) |>
  count(id, name = "n_grades") |>
  left_join(students |> select(id, group, sex), by = "id")

grades_count |> 
  slice_head(n = 10) |> 
  kable()

summary_tbl <- grades_count |>
  summarise(
    min = min(n_grades),
    max = max(n_grades),
    avg = mean(n_grades),
    median = median(n_grades)
  ) 
summary_tbl |> kable()
```

## Q14

```{r}
#| message: false
#| warning: false
grades_count |>
  ggplot(aes(x = n_grades, fill = sex)) +
  geom_histogram(position = "identity", alpha = 0.5, binwidth = 1)
```

The histogram compares the distribution of the number of grades per student for female and male students. From the figure, we can observe that:

-   Both distributions are very similar: regardless of their sex, the majority of the students have between 58 and 62 grades recorded, and the overall shape of the distributions overlaps almost perfectly.
-   Slight differences: female students have a slightly wider spread toward lower numbers of grades (around 56–58) and male students appear a little more concentrated around 60–62 grades. However, these differences are small.
-   There is no strong difference between males and females in terms of how many grades they received. Both groups have roughly the same average and the same range.

## Q15

```{r}
#| message: false
#| warning: false
music_id <- courses |> 
  filter(course == "Music and Poetry") |> 
  pull(course_id)

music_counts <- grades |>
  filter(course_id == music_id) |>
  drop_na(grade) |>
  count(id, name = "n_music_poetry") |>
  left_join(students |> select(id, group), by = "id")

music_counts |> slice_head(n = 10) |> kable()
```

## Q16

```{r}
#| message: false
#| warning: false
music_counts |>
  count(n_music_poetry, name = "num_students") |>
  ggplot(aes(x = n_music_poetry, y = num_students)) +
  geom_col() +
  labs(
    x = "Number of grades in Music and Poetry",
    y = "Number of students",
    title = "Distribution of number of grades per student"
  ) +
  theme_minimal()
```

## Q17

```{r}
#| message: false
#| warning: false
music_counts |>
  ggplot(aes(x = group, y = n_music_poetry)) +
  geom_boxplot()+
  labs(
    x = "Group",
    y = "Number of Grades in Music & Poetry",
    title = "Number of Grades in Music and Poetry per Student by Group",
    subtitle = "Boxplot showing whether grade counts differ across student groups"
  ) +
  theme_minimal()
```

The boxplot shows the distribution of `n_music_poetry` (the number of grades a student received in Music and Poetry combined) for each of the 18 groups. We can observe that :

-   The number of grades is extremely similar across all groups: most groups have values tightly concentrated between 9 and 10 grades, and the medians are almost identical and very close to 10.
-   The variability inside each group is very small: each box is very narrow and most groups only show small fluctuations (occasional 8s, 9s, 10s).
-   There are occasional lower outliers (8 grades) in some groups, but they appear in several groups and they do not form a pattern indicating one group systematically has fewer grades.
-   No group stands out with higher or lower grade counts, all groups show essentially the same distribution.

Therefore, there is no evidence that the number of grades per student in Music and Poetry depends on the group. All groups have almost the same distribution, with nearly constant numbers of grades (mostly 9–10). So the group does not appear to influence the number of grades received.

## Q18

```{r}
#| message: false
#| warning: false
music_id <- courses |> 
  filter(course == "Music and Poetry") |> 
  pull(course_id)

music_counts <- grades |>
  filter(course_id == music_id) |>
  drop_na(grade) |>
  count(id, name = "n_music_poetry") |>
  left_join(students |> select(id, group, sex), by = "id")

music_counts |>
  ggplot(aes(x = group, y = n_music_poetry, fill = sex)) +
  geom_boxplot() +
  labs(
    title = "Number of Music & Poetry Grades by Group and Sex",
    x = "Group",
    y = "Number of Grades",
    fill = "Sex"
  ) +
  theme_minimal()
```

We can observe that:

-   The distribution is almost identical for males and females across all groups: in every group, both sexes typically have 9 or 10 grades and the medians overlap perfectly.
-   There is no visible trend or difference between groups: all groups show nearly the same range (from 8 to 10 grades) and no group shows a sex-determined shift.
-   There is no interaction effect between group and sex: if such an effect existed, we would expect to see one sex systematically having more or fewer grades in some groups. This is not the case: both sexes behave almost identically in every group.

Therefore, the number of grades in Music & Poetry does not depend on the group of the student nor on the sex of the student. Also, there is no interaction between group and sex either.

## Q19

```{r}
#| message: false
#| warning: false
avg_per_course <- grades |>
  left_join(courses, by = "course_id") |>
  left_join(students |> select(id, group), by = "id") |>
  group_by(id, group, course) |>
  summarise(avg_grade = mean(grade, na.rm = TRUE), .groups = "drop") |>
  pivot_wider(
    names_from = course,
    values_from = avg_grade
  )

avg_per_course |>
  mutate(`Architecture and Sculpture` =
           round(`Architecture and Sculpture`, 2)) |>
  select(
    id,
    group,
    `Architecture and Sculpture`,
    `Astronomy and Cosmology`
  ) |>
  slice_head(n = 5) |>
  kable()
```

## Q20

```{r}
#| message: false
#| warning: false
medicine_id <- courses |> filter(course == "Medicine and Healing Arts") |> pull(course_id)

avg_combat_medicine <- grades |>
  filter(course_id %in% c(combat_id, medicine_id)) |>
  left_join(students, by = "id") |>
  left_join(courses, by = "course_id") |>
  group_by(id, course) |>
  summarise(avg = mean(grade), .groups = "drop") |>
  pivot_wider(names_from = course, values_from = avg)

ggplot(avg_combat_medicine,
       aes(x = `Medicine and Healing Arts`,
           y = `Combat and Martial Arts of the Gods`)) +
  geom_point(aes(color = "Students"), alpha = 0.5, size = 2) +
  geom_smooth(aes(color = "Linear trend"), method = "lm", se = FALSE, linewidth = 1) +
  scale_color_manual(
    name = "Legend",
    values = c(
      "Students" = "salmon",
      "Linear trend" = "steelblue"
    )
  ) +
    labs(
    title = "Average Grades: Combat vs Medicine",
    x = "Average Grade in Medicine and Healing Arts",
    y = "Average Grade in Combat and Martial Arts of the Gods"
  ) +
  theme_minimal(base_size = 14)
```

## Q21

```{r}
#| message: false
#| warning: false
myth_id <- courses |> filter(course == "Greek Mythology and Folklore") |> pull(course_id)

corr_tbl <- avg_per_course |>
  group_by(group) |>
  summarise(
    correlation = cor(`Music and Poetry`, `Greek Mythology and Folklore`, use = "complete.obs")
  )

corr_tbl |>
  slice_head(n = 5) |>
  kable()
```

## Q22

```{r}
#| message: false
#| warning: false
best_group <- corr_tbl |>
  slice_max(abs(correlation)) |>
  pull(group)

avg_per_course |>
  filter(group == best_group) |>
  ggplot(aes(x = `Greek Mythology and Folklore`, y = `Music and Poetry`)) +
  geom_point(color="darkgreen")
```

## Q23

```{r}
#| message: false
#| warning: false
final_dataframe <- avg_per_course |>
  mutate(final_grade = rowMeans(across(-c(id, group)), na.rm = TRUE)) |>
  left_join(select(students, id, sex), by = "id") |>
  select(id, group, sex, final_grade) |>
  arrange(desc(final_grade))

final_dataframe |>
  slice_head(n = 5) |>
  kable()
```

## Q24

```{r}
#| message: false
#| warning: false
ggplot(final_dataframe, aes(x = group, y = final_grade)) +
  geom_boxplot(show.legend = FALSE) +
  labs(
    title = "Distribution of Final Grades by Group",
    x = "Group",
    y = "Final Grade"
  ) 
```

The boxplot highlights noticeable differences in the distribution of final grades across groups. Although most groups have median final grades close to 10.5–11.0, several groups clearly stand out:

-   Groups 5, 6 and 16 show higher median final grades, with relatively tight interquartile ranges. These groups appear to perform consistently better than others.
-   Groups 8 and 15 have significantly lower medians and larger variability, suggesting weaker average performance and a more heterogeneous level among students.
-   Some groups (such as 13 and 18) display several outliers, indicating a few students performing much better or worse than the general trend of their group.

Overall, while the general level across groups remains similar, the plot reveals meaningful differences in both median performance and grade dispersion, suggesting that the group a student belongs to might influence their final grade to some extent.

## Q25

```{r}
#| message: false
#| warning: false
ggplot(final_dataframe, aes(x = factor(group), y = final_grade, fill = sex)) +
  geom_boxplot(alpha = 0.8) +
  labs(
    title = "Distribution of Final Grades by Group and Sex",
    x = "Group",
    y = "Final Grade",
    fill = "Sex"
  ) +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal(base_size = 14)
```

Including sex in the analysis reveals that differences in final grades between males and females vary across groups. In most groups, the distributions for males and females are very similar, showing no strong systematic performance gap between sexes. However, in a few groups (for example groups 1, 3, 6, 8, 15, or 16), one sex appears to have slightly higher median final grades or a narrower spread, suggesting that sex may have a small effect depending on the group.

Overall, the plot shows that:

-   Variation between groups is larger than variation between sexes,
-   Sex differences, when present, tend to be small,
-   No group shows a dramatic separation between male and female students.

This suggests that sex does not strongly influence final grades, although minor sex-related differences can appear within certain groups.

## Q26

```{r}
#| message: false
#| warning: false
course_pass <- avg_per_course |>
  mutate(pass_course = apply(across(-c(id, group)), 1, function(x) all(x >= 5)))

trimester_info <- courses |> select(course, trimester)

trimester_avg <- avg_per_course |>
  pivot_longer(cols = -c(id, group), names_to = "course", values_to = "avg") |>
  left_join(trimester_info, by = "course") |>
  group_by(id, trimester) |>
  summarise(trimester_mean = mean(avg, na.rm = TRUE), .groups = "drop") |>
  group_by(id) |>
  summarise(trimester_pass = all(trimester_mean >= 10), .groups = "drop")

pass_df <- avg_per_course |>
  mutate(final_grade = rowMeans(across(-c(id, group)), na.rm = TRUE)) |>
  left_join(select(course_pass, id, pass_course), by = "id") |>
  left_join(trimester_avg, by = "id") |>
  mutate(pass = pass_course & trimester_pass) |>
  select(id, group, final_grade, pass)
```

## Q27
```{r}
#| message: false
#| warning: false
failers <- pass_df |> filter(!pass & final_grade >= 10) |> nrow()
```

There are `r failers` students who do not pass and yet have a final grade larger or equal to 10.

## Q28
```{r}
#| message: false
#| warning: false
pass_df |>
  group_by(group) |>
  summarise(pass_rate = mean(pass)) |>
  ggplot(aes(x = group, y = pass_rate)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Pass Rate per Group",
    x = "Group",
    y = "Pass Rate"
  ) +
  ylim(0, 1)
```
The plot shows substantial variation in pass rates across groups. Some groups (such as groups 6 and 16) achieve very high pass rates, while others (notably groups 8 and 15) have very low pass rates. This indicates that the likelihood of passing the year differs meaningfully between groups, suggesting differences in performance, difficulty, or student composition across groups.

## Q29
```{r}
#| message: false
#| warning: false
fail_counts <- avg_per_course  |>
  pivot_longer(-c(id, group), names_to = "course", values_to = "avg")  |>
  filter(avg < 5)  |>
  count(course)  |>
  arrange(desc(n))
fail_counts |> kable()
```
Therefore, the **Combat and Martial Arts of the Gods** course is the most responsible one for student failure owing to grades below than 5 (in this course, 2 students obtained a grade below 5). 

## Q30
```{r}
#| message: false
#| warning: false
pass_df |>
  left_join(students |> select(id, age), by = "id") |>
  group_by(age) |>
  summarise(success_rate = mean(pass)) |>
  ggplot(aes(x = age, y = success_rate)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Success Rate as a Function of Age",
    x = "Age",
    y = "Success Rate"
  )
```
The plot shows that the success rate varies noticeably across ages, without a perfectly smooth trend.
Students around 22–26 years old tend to have a moderate success rate (around 45–60%), with relatively small fluctuations.
After age 28, success rates become much more variable: there are ages with very low success (even 0% at age 29 and 32), and ages with very high success, including a peak at 100% (at age), likely because those ages have few students, making the rate more unstable.

Overall, the graph suggests that age does not have a simple linear effect on success. Instead, the pattern appears influenced both by age and by the number of students at each age, with smaller age groups producing more extreme success rates.

