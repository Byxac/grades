---
title: "PERRY"
author: "Daphné Perry"
format: html
---

```{r}
#| message: false
#| warning: false
library(vroom)
library(ggplot2)
library(knitr)
library(dplyr)
library(here)
library(tidyr)
library(lubridate)
library(readr)
library(tidyverse)
here::i_am("grades.Rproj")
```

# Introduction

## Q1:

```{r}
courses <- vroom(here("data", "courses.csv"))
```

## Q2

```{r}
#| message: false
#| warning: false
courses |>
  arrange(course) |>
  rename(
    "course name" = course,
    "identifier" = course_id,
    "trimester" = trimester,
    "number of exams" = nb_grades 
  ) |>
  kable()
```

## Q3

```{r}
students <- vroom(here("data", "students.csv"))|>
   mutate(
    birth_date = ymd(birth_date),
    sex = factor(sex),
    group = factor(group)
  )
```

In the `students` dataset, the `birth_date` variable is correctly stored as a `Date` object.

## Q4

```{r}
grades <- read_delim(
  "data/grades.csv",
  delim = ";",
  na = "_"
)
```

## Q5

```{r}
students |>
  count(group) |>
  ggplot(aes(x = group, y = n)) +
  geom_col()
```

## Q6

```{r}
students |>
  count(group, sex) |>
  ggplot(aes(x = group, y = n, fill = sex)) +
  geom_col(position = "dodge")
```

## Q7

```{r}
students <- students |>
  mutate(
    age = time_length(today() - birth_date, "year") |> round()
  )

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1)
```

## Q8

```{r}
median_age <- students |> 
  group_by(group) |> 
  summarise(median_age = as.integer(median(age)))

median_age |> 
  kable(col.names = c("Group", "Median age"))
```

## Q9

```{r}
students |>
  arrange(desc(age)) |>
  group_by(group) |>
  slice_max(age, n = 1) |>
  ungroup() |>
  arrange(desc(age)) |>
  select(id, sex, age, group) |>
  kable()
```

## Q10

The data set contains `r grades |> drop_na(grade) |> nrow()` grades.

## Q11

```{r}
combat_id <- courses |> 
  filter(course == "Combat and Martial Arts of the Gods") |> 
  pull(course_id)

grades |>
  filter(course_id == combat_id) |>
  left_join(students, by = "id") |>
  group_by(group) |>
  summarise(avg_combat = mean(grade, na.rm = TRUE)) |>
  ggplot(aes(x = group, y = avg_combat)) +
  geom_col()
```

Even though the average grade in the **Combat and Martial Arts of the Gods** class is around 8 for every group, the grades can go from 0 up to 20 (so this graphic is not that representative, but if we scale the average grade from 0 to 20, the differences between the groups are harder to observe). 

## Q12
```{r}
#| message: false
#| warning: false
grades |>
  left_join(courses, by = "course_id") |>
  ggplot(aes(x = grade, fill = factor(trimester))) +
  geom_density(alpha = 0.5)
```
The graph shows the density distributions of grades for the three trimesters. From the plot, we can observe the following patterns:

**Trimester 1**: The grades are almost following a distribution,  centered around higher grades (roughly between 8 and 12).
It has the highest peak, meaning grades are more concentrated around that central value.
Overall, trimester 1 appears to have the best performance.

**Trimester 2**: The distribution is more spread out and slightly shifted to the right compared to trimester 1.
The peak is lower, meaning grades are more variable.
Grades range roughly from 7 to 15, with many around 8–10.
Performance is solid but less consistent than in trimester 1.

**Trimester 3**: The distribution is clearly shifted toward lower grades.
Many grades fall between 5 and 10, with a peak around 7 (almost 25% of the students have this grade). 
There is also a long right tail: this is the semester with the largest proportion of students having 20/20 (about 2,5%, compared to almost 0 during the other trimesters).
Trimester 3 shows the lowest performance overall.

## Q13
```{r}
grades_count <- grades |>
  drop_na(grade) |>
  count(id, name = "n_grades") |>
  left_join(students |> select(id, group, sex), by = "id")

grades_count |> 
  slice_head(n = 10) |> 
  kable()

summary_tbl <- grades_count |>
  summarise(
    min = min(n_grades),
    max = max(n_grades),
    avg = mean(n_grades),
    median = median(n_grades)
  ) 
summary_tbl |> kable()
```


